!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Papyros=t():e.Papyros=t()}(self,(function(){return(()=>{var e={137:e=>{self,e.exports=(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{serviceWorkerFetchListener:()=>i,asyncSleep:()=>s,ServiceWorkerError:()=>u,writeMessageAtomics:()=>a,writeMessageServiceWorker:()=>c,writeMessage:()=>l,makeChannel:()=>f,makeAtomicsChannel:()=>d,makeServiceWorkerChannel:()=>p,readMessage:()=>h,syncSleep:()=>m,uuidv4:()=>v});var n=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))};const r="__SyncMessageServiceWorkerInput__",o="__sync-message-v2__";function i(){const e={},t={};return i=>{const{url:s}=i.request;return!!s.includes(r)&&(i.respondWith(function(){return n(this,void 0,void 0,(function*(){function n(e){const t={message:e,version:o};return new Response(JSON.stringify(t),{status:200})}if(s.endsWith("/read")){const{messageId:r,timeout:o}=yield i.request.json(),s=e[r];return s?(delete e[r],n(s)):yield new Promise((e=>{t[r]=e,setTimeout((function(){delete t[r],e(new Response("",{status:408}))}),o)}))}if(s.endsWith("/write")){const{message:r,messageId:o}=yield i.request.json(),s=t[o];return s?(s(n(r)),delete t[o]):e[o]=r,n({early:!s})}if(s.endsWith("/version"))return new Response(o,{status:200})}))}()),!0)}}function s(e){return new Promise((t=>setTimeout(t,e)))}class u extends Error{constructor(e,t){super(`Received status ${t} from ${e}. Ensure the service worker is registered and active.`),this.url=e,this.status=t,this.type="ServiceWorkerError",Object.setPrototypeOf(this,u.prototype)}}function a(e,t){const n=(new TextEncoder).encode(JSON.stringify(t)),{data:r,meta:o}=e;if(n.length>r.length)throw new Error("Message is too big, increase bufferSize when making channel.");r.set(n,0),Atomics.store(o,0,n.length),Atomics.store(o,1,1),Atomics.notify(o,1)}function c(e,t,r){return n(this,void 0,void 0,(function*(){yield navigator.serviceWorker.ready;const n=e.baseUrl+"/write",i=Date.now();for(;;){const a={message:t,messageId:r},c=yield fetch(n,{method:"POST",body:JSON.stringify(a)});if(200===c.status&&(yield c.json()).version===o)return;if(!(Date.now()-i<e.timeout))throw new u(n,c.status);yield s(100)}}))}function l(e,t,r){return n(this,void 0,void 0,(function*(){"atomics"===e.type?a(e,t):yield c(e,t,r)}))}function f(e={}){return"undefined"!=typeof SharedArrayBuffer?d(e.atomics):"serviceWorker"in navigator?p(e.serviceWorker):null}function d({bufferSize:e}={}){return{type:"atomics",data:new Uint8Array(new SharedArrayBuffer(e||131072)),meta:new Int32Array(new SharedArrayBuffer(2*Int32Array.BYTES_PER_ELEMENT))}}function p(e={}){return{type:"serviceWorker",baseUrl:(e.scope||"/")+r,timeout:e.timeout||5e3}}function y(e,t){return e>0?+e:t}function h(e,t,{checkInterrupt:n,checkTimeout:r,timeout:i}={}){const s=performance.now();r=y(r,n?100:5e3);const a=y(i,Number.POSITIVE_INFINITY);let c;if("atomics"===e.type){const{data:t,meta:n}=e;c=()=>{if("timed-out"===Atomics.wait(n,1,0,r))return null;{const e=Atomics.exchange(n,0,0),r=t.slice(0,e);Atomics.store(n,1,0);const o=(new TextDecoder).decode(r);return JSON.parse(o)}}}else c=()=>{const n=new XMLHttpRequest,i=e.baseUrl+"/read";n.open("POST",i,!1);const a={messageId:t,timeout:r};n.send(JSON.stringify(a));const{status:c}=n;if(408===c)return null;if(200===c){const e=JSON.parse(n.responseText);return e.version!==o?null:e.message}if(performance.now()-s<e.timeout)return null;throw new u(i,c)};for(;;){const e=a-(performance.now()-s);if(e<=0)return null;r=Math.min(r,e);const t=c();if(null!==t)return t;if(null==n?void 0:n())return null}}function m(e,t){if(e=y(e,0))if("undefined"!=typeof SharedArrayBuffer){const t=new Int32Array(new SharedArrayBuffer(Int32Array.BYTES_PER_ELEMENT));t[0]=0,Atomics.wait(t,0,0,e)}else h(t,`sleep ${e} ${v()}`,{timeout:e})}let v;return v="randomUUID"in crypto?function(){return crypto.randomUUID()}:function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>{const t=Number(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))},t})()},566:(e,t,n)=>{"use strict";n.d(t,{InputWorker:()=>s});var r=n(137),o=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))},i=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},s=function(){function e(e){this.hostName=e,this.syncMessageListener=(0,r.serviceWorkerFetchListener)()}return e.prototype.handleInputRequest=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(t){return this.syncMessageListener(e)?[2,!0]:e.request.url.includes(this.hostName)?(e.respondWith(fetch(e.request).then((function(e){var t=new Headers(e.headers);return t.set("Cross-Origin-Embedder-Policy","require-corp"),t.set("Cross-Origin-Opener-Policy","same-origin"),t.set("Cross-Origin-Resource-Policy","cross-origin"),new Response(e.body,{status:e.status||200,statusText:e.statusText,headers:t})}))),[2,!0]):[2,!1]}))}))},e}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.r(r);var e=n(566),t=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function u(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((r=r.apply(e,t||[])).next())}))},o=function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},i=location.href;i=i.slice(0,i.lastIndexOf("/")+1);var s=new e.InputWorker(i);addEventListener("fetch",(function(e){return t(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return[4,s.handleInputRequest(e)];case 1:return t.sent(),[2]}}))}))})),addEventListener("install",(function(e){e.waitUntil(skipWaiting())})),addEventListener("activate",(function(e){e.waitUntil(clients.claim())}))})(),r})()}));