var b={exports:{}},x;function U(){return x||(x=1,(function(l,y){(function(h,f){l.exports=f()})(self,(function(){return(()=>{var h={d:(e,t)=>{for(var r in t)h.o(t,r)&&!h.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},f={};h.r(f),h.d(f,{isServiceWorkerRequest:()=>A,serviceWorkerFetchListener:()=>N,asyncSleep:()=>I,ServiceWorkerError:()=>w,writeMessageAtomics:()=>O,writeMessageServiceWorker:()=>W,writeMessage:()=>M,makeChannel:()=>_,makeAtomicsChannel:()=>T,makeServiceWorkerChannel:()=>P,readMessage:()=>R,syncSleep:()=>q,uuidv4:()=>k});var m=function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function o(i){try{c(n.next(i))}catch(d){s(d)}}function u(i){try{c(n.throw(i))}catch(d){s(d)}}function c(i){var d;i.done?a(i.value):(d=i.value,d instanceof r?d:new r((function(p){p(d)}))).then(o,u)}c((n=n.apply(e,[])).next())}))};const S="__SyncMessageServiceWorkerInput__",g="__sync-message-v2__";function A(e){return typeof e!="string"&&(e=e.request.url),e.includes(S)}function N(){const e={},t={};return r=>{const{url:n}=r.request;return!!A(n)&&(r.respondWith((function(){return m(this,void 0,void 0,(function*(){function a(s){const o={message:s,version:g};return new Response(JSON.stringify(o),{status:200})}if(n.endsWith("/read")){const{messageId:s,timeout:o}=yield r.request.json();if(s in e){const u=e[s];return delete e[s],a(u)}return yield new Promise((u=>{t[s]=u,setTimeout((function(){delete t[s],u(new Response("",{status:408}))}),o)}))}if(n.endsWith("/write")){const{message:s,messageId:o}=yield r.request.json(),u=t[o];return u?(u(a(s)),delete t[o]):e[o]=s,a({early:!u})}if(n.endsWith("/version"))return new Response(g,{status:200})}))})()),!0)}}function I(e){return new Promise((t=>setTimeout(t,e)))}class w extends Error{constructor(t,r){super(`Received status ${r} from ${t}. Ensure the service worker is registered and active.`),this.url=t,this.status=r,this.type="ServiceWorkerError",Object.setPrototypeOf(this,w.prototype)}}function O(e,t){const r=new TextEncoder().encode(JSON.stringify(t)),{data:n,meta:a}=e;if(r.length>n.length)throw new Error("Message is too big, increase bufferSize when making channel.");n.set(r,0),Atomics.store(a,0,r.length),Atomics.store(a,1,1),Atomics.notify(a,1)}function W(e,t,r){return m(this,void 0,void 0,(function*(){yield navigator.serviceWorker.ready;const n=e.baseUrl+"/write",a=Date.now();for(;;){const s={message:t,messageId:r},o=yield fetch(n,{method:"POST",body:JSON.stringify(s)});if(o.status===200&&(yield o.json()).version===g)return;if(!(Date.now()-a<e.timeout))throw new w(n,o.status);yield I(100)}}))}function M(e,t,r){return m(this,void 0,void 0,(function*(){e.type==="atomics"?O(e,t):yield W(e,t,r)}))}function _(e={}){return typeof SharedArrayBuffer<"u"?T(e.atomics):"serviceWorker"in navigator?P(e.serviceWorker):null}function T({bufferSize:e}={}){return{type:"atomics",data:new Uint8Array(new SharedArrayBuffer(e||131072)),meta:new Int32Array(new SharedArrayBuffer(2*Int32Array.BYTES_PER_ELEMENT))}}function P(e={}){return{type:"serviceWorker",baseUrl:(e.scope||"/")+S,timeout:e.timeout||5e3}}function E(e,t){return e>0?+e:t}function R(e,t,{checkInterrupt:r,checkTimeout:n,timeout:a}={}){const s=performance.now();n=E(n,r?100:5e3);const o=E(a,Number.POSITIVE_INFINITY);let u;if(e.type==="atomics"){const{data:c,meta:i}=e;u=()=>{if(Atomics.wait(i,1,0,n)==="timed-out")return null;{const d=Atomics.exchange(i,0,0),p=c.slice(0,d);Atomics.store(i,1,0);const v=new TextDecoder().decode(p);return JSON.parse(v)}}}else u=()=>{const c=new XMLHttpRequest,i=e.baseUrl+"/read";c.open("POST",i,!1);const d={messageId:t,timeout:n};c.send(JSON.stringify(d));const{status:p}=c;if(p===408)return null;if(p===200){const v=JSON.parse(c.responseText);return v.version!==g?null:v.message}if(performance.now()-s<e.timeout)return null;throw new w(i,p)};for(;;){const c=o-(performance.now()-s);if(c<=0)return null;n=Math.min(n,c);const i=u();if(i!==null)return i;if(r?.())return null}}function q(e,t){if(e=E(e,0))if(typeof SharedArrayBuffer<"u"){const r=new Int32Array(new SharedArrayBuffer(Int32Array.BYTES_PER_ELEMENT));r[0]=0,Atomics.wait(r,0,0,e)}else R(t,`sleep ${e} ${k()}`,{timeout:e})}let k;return k="randomUUID"in crypto?function(){return crypto.randomUUID()}:function(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>{const t=Number(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))},f})()}))})(b)),b.exports}var L=U();class j{constructor(y=""){this.hostName=y,this.syncMessageListener=L.serviceWorkerFetchListener()}async handleInputRequest(y){if(this.syncMessageListener(y))return!0;const h=y.request.url;return this.hostName&&h.includes(this.hostName)?(y.respondWith(fetch(y.request).then(f=>{const m=new Headers(f.headers);return m.set("Cross-Origin-Embedder-Policy","require-corp"),m.set("Cross-Origin-Opener-Policy","same-origin"),m.set("Cross-Origin-Resource-Policy","cross-origin"),new Response(f.body,{status:f.status||200,statusText:f.statusText,headers:m})})),!0):!1}}const B="",D=new j(B);addEventListener("fetch",async function(l){await D.handleInputRequest(l)});addEventListener("install",function(l){l.waitUntil(skipWaiting())});addEventListener("activate",function(l){l.waitUntil(clients.claim())});
